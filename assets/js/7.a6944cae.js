(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{525:function(e,t,n){e.exports=n.p+"assets/img/vite-con-1.4be2cda4.png"},526:function(e,t,n){e.exports=n.p+"assets/img/vite-con-2.9712378e.png"},527:function(e,t,n){e.exports=n.p+"assets/img/vite-con-03yw.e7808ceb.png"},681:function(e,t,n){"use strict";n.r(t);var o=n(1),s=Object(o.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"an-introduction-to-vite-connect"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#an-introduction-to-vite-connect"}},[e._v("#")]),e._v(" An Introduction to Vite Connect")]),e._v(" "),o("h2",{attrs:{id:"background"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#background"}},[e._v("#")]),e._v(" Background")]),e._v(" "),o("p",[e._v("As more third-party gateways are integrated into ViteX, an increasing security risk has been posed due to the increasing number of third-party services. Storing mnemonic seeds (or private keys) in browser becomes insufficient. An urgent need has arisen to find a remote signing solution in order to separate mnemonics/keys from web client. As an alternative of hardware wallet, it should use the private key saved in Vite mobile app to sign transactions sent from Vite web wallet. The final solution must be safe, convenient, and easy to implement.")]),e._v(" "),o("p",[e._v("Let’s see two existing solutions first:")]),e._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/MyEtherWallet/MEWconnect",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/MyEtherWallet/MEWconnect"),o("OutboundLink")],1)]),e._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/WalletConnect/walletconnect-monorepo",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/WalletConnect/walletconnect-monorepo"),o("OutboundLink")],1)]),e._v(" "),o("p",[e._v("The major difference of the two solutions is the connection type between peers. Hereinafter I borrow some terms and diagrams from WebRTC architecture on "),o("a",{attrs:{href:"https://developer.mozilla.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://developer.mozilla.org"),o("OutboundLink")],1),e._v(" for illustration.")]),e._v(" "),o("h2",{attrs:{id:"mewconnect"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#mewconnect"}},[e._v("#")]),e._v(" MEWconnect")]),e._v(" "),o("p",[o("img",{attrs:{src:n(525),alt:""}})]),e._v(" "),o("ol",[o("li",[o("p",[e._v("MEWconnect implements a similar STUN (Session Traversal Utilities for NAT) server. The server detects the NAT type of two peers and exposes the public network address of each other to both parties (Note: this cannot be achieved under some NAT types).")])]),e._v(" "),o("li",[o("p",[e._v("After knowing the public network addresses of each other, the two peers communicate directly.")])])]),e._v(" "),o("p",[e._v("MEWconnect has no relay server. No one has access to communication data except the two peers. However, since most 3/4G network is under symmetric NAT where P2P communication cannot be realized, MEWconnect does not meet our requirement.")]),e._v(" "),o("h2",{attrs:{id:"walletconnect"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#walletconnect"}},[e._v("#")]),e._v(" WalletConnect")]),e._v(" "),o("p",[o("img",{attrs:{src:n(526),alt:""}})]),e._v(" "),o("p",[e._v("WalletConnect implements a relay server like TURN (Traversal Using Relays around NAT). Once registered, the two peers are able to find each other and communicate through the relay server, so communications can be normally conducted in 3/4G network. This is the design we finally adopted in ViteConnect.")]),e._v(" "),o("p",[e._v("Let’s take a deeper look at the handshake process of a web client and a mobile app — the typical use scenario of ViteConnect.")]),e._v(" "),o("h2",{attrs:{id:"handshake-process-in-walletconnect"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#handshake-process-in-walletconnect"}},[e._v("#")]),e._v(" Handshake Process in WalletConnect")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("The web client generates a key and a handshake topic, then displays in the form of QR code, which also includes server’s internet address.")])]),e._v(" "),o("li",[o("p",[e._v("The web client sends a session request to handshake topic on the server, carrying a webclient topic, and then subscribes to the webclient topic for incoming messages.")])]),e._v(" "),o("li",[o("p",[e._v("The mobile app scans the QR code, connects to the server, and takes the session request from the handshake topic. After decrypting the message with the key, the mobile app is able to get the webclient topic. Subsequent messages to the web client will be published through the topic. At this time, the mobile app will send an approveSession message, carrying a mobileclient topic.")])]),e._v(" "),o("li",[o("p",[e._v("The web client receives the approveSession message, retrieves the mobileclient topic. Subsequent messages to the mobile app will be published through the topic.")])])]),e._v(" "),o("p",[o("img",{attrs:{src:n(527),alt:""}})]),e._v(" "),o("h2",{attrs:{id:"features"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#features"}},[e._v("#")]),e._v(" Features")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("All messages are encrypted. The encryption key is only known by the two parties and transparent to the server.")])]),e._v(" "),o("li",[o("p",[e._v("During session establishment, private topics (webclient topic, mobileclient topic) are exchanged in secure and will not be disclosed.")])]),e._v(" "),o("li",[o("p",[e._v("Session request is sent and consumed only once, thus ensuring that even if the contents of handshake topic and encryption key in the QR code are leaked, the attacker cannot access the private topics of the two parties.")])])]),e._v(" "),o("h2",{attrs:{id:"existing-problems-of-walletconnect"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#existing-problems-of-walletconnect"}},[e._v("#")]),e._v(" Existing Problems of WalletConnect")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("The encryption key is not updated during handshake. If the QR code and encrypted message are exposed, a third party can read the message.")])]),e._v(" "),o("li",[o("p",[e._v("Private topic is generated only once and cached locally in device. Once leaked, encrypted message can be intercepted by a third party.")])]),e._v(" "),o("li",[o("p",[e._v("Peers cannot see each other, further the server does not know the corresponding relation between topics. The decoupling between peer and server may reason for security purpose. However, this also brings difficulties for implementing reconnection.")])]),e._v(" "),o("li",[o("p",[e._v("Both server and web client use socket.readyState===1 to determine if it is ready to send the message. However, in our testing after the connection is broken, socket.readyState still keeps valid in next 5–7s. Messages during this time may be lost.")])])]),e._v(" "),o("p",[e._v("Overall, the handshake process is cleverly designed. However, lacking of reconnection mechanism, server-side message storage, and topic recycling still leaves improvement space.")]),e._v(" "),o("h2",{attrs:{id:"our-work"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#our-work"}},[e._v("#")]),e._v(" Our work")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Because ViteX’s users are globally located, one single server would cause high latency to some users and poor stability, thus multiple distributed servers should be set up.")])]),e._v(" "),o("li",[o("p",[e._v("To solve the state agnostic problem between two peers, a heartbeat mechanism is introduced in ViteConnect. If the heartbeat of one party is not detected within 10s, the other party will send a disconnection message and then close the connection.")])]),e._v(" "),o("li",[o("p",[e._v("To recycle unused topics, ViteConnect guarantees there is only one topic for every session. Long-term (1h) unused topics will be recycled.")])]),e._v(" "),o("li",[o("p",[e._v("A basic monitor has been employed.")])])]),e._v(" "),o("p",[e._v("After the first version of ViteConnect was released, the peak topic number in the first day was around 3700, serving more than 1200 users at the same time.")]),e._v(" "),o("h2",{attrs:{id:"optimizations-in-v2"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#optimizations-in-v2"}},[e._v("#")]),e._v(" Optimizations in V2")]),e._v(" "),o("p",[e._v("According to feedbacks, in the first version messages were sometimes lost, and connections were dropped when screen lock.")]),e._v(" "),o("p",[e._v("This is a stability/real-time tradeoff. In a poor network environment, whether to wait for the message to arrive or disconnect connection immediately for liveness is not always easy to decide. Considering the difficulty of liveness preservation in mobile app and measuring the impact of network delay, we chose to implement the reconnection mechanism in ViteConnect.")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Add a unique sequence number to each message, so that peers can re-subscribe from the last index after reconnecting.")])]),e._v(" "),o("li",[o("p",[e._v("Introduce new message types:")]),e._v(" "),o("p",[e._v("a.  Session related messages. The messages should only be consumed once for security reasons.")]),e._v(" "),o("p",[e._v("b.  In the purpose of connection optimization, messages between peer and server should not be encrypted.")]),e._v(" "),o("p",[e._v("c.  Private messages should be kept on the server for a certain period of time, in case of topic re-subscription after reconnecting.")]),e._v(" "),o("p",[e._v("d.  Topics are recycled when idling for a certain period of time.")])]),e._v(" "),o("li",[o("p",[e._v("Support version control. Version of message/peer should be detected by server. The server should select different processing methods when dealing with different versions of peers and messages.")])])]),e._v(" "),o("h2",{attrs:{id:"reference-materials"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#reference-materials"}},[e._v("#")]),e._v(" Reference materials:")]),e._v(" "),o("p",[o("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Protocols",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Protocols"),o("OutboundLink")],1)]),e._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/MyEtherWallet/MEWconnect",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/MyEtherWallet/MEWconnect"),o("OutboundLink")],1)]),e._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/WalletConnect/walletconnect-monorepo",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/WalletConnect/walletconnect-monorepo"),o("OutboundLink")],1)]),e._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/WalletConnect/node-walletconnect-bridge",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/WalletConnect/node-walletconnect-bridge"),o("OutboundLink")],1)]),e._v(" "),o("p",[o("a",{attrs:{href:"https://www.jianshu.com/p/a6713687bc1d",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.jianshu.com/p/a6713687bc1d"),o("OutboundLink")],1)]),e._v(" "),o("p",[o("a",{attrs:{href:"https://www.jianshu.com/p/ecde412d2eeb",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.jianshu.com/p/ecde412d2eeb"),o("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=s.exports}}]);