(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{626:function(e,t,a){e.exports=a.p+"assets/img/know-how-1-simple.164410b8.png"},627:function(e,t,a){e.exports=a.p+"assets/img/compiled-solidity-simple.5cf8de44.png"},628:function(e,t,a){e.exports=a.p+"assets/img/compiled-soliditypp-simple.b0b81e01.png"},629:function(e,t,a){e.exports=a.p+"assets/img/referrer-simple.9baf0bf7.png"},630:function(e,t,a){e.exports=a.p+"assets/img/know-how-1.8bf4e330.png"},631:function(e,t,a){e.exports=a.p+"assets/img/compiled-solidity.710abe54.png"},632:function(e,t,a){e.exports=a.p+"assets/img/compiled-soliditypp.9bfae2b4.png"},633:function(e,t,a){e.exports=a.p+"assets/img/referrer.25612b20.png"},806:function(e,t,a){"use strict";a.r(t);var c=a(1),o=Object(c.a)({},(function(){var e=this,t=e.$createElement,c=e._self._c||t;return c("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[c("h1",{attrs:{id:"vep-19-implement-synchronous-function-calls-to-vite-contracts"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#vep-19-implement-synchronous-function-calls-to-vite-contracts"}},[e._v("#")]),e._v(" VEP-19: Implement Synchronous Function Calls to Vite Contracts")]),e._v(" "),c("h1",{attrs:{id:"background"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#background"}},[e._v("#")]),e._v(" Background")]),e._v(" "),c("h2",{attrs:{id:"composability"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#composability"}},[e._v("#")]),e._v(" Composability")]),e._v(" "),c("p",[c("strong",[e._v("Composability")]),e._v(" is one of the core features of a decentralized ecosystem, that is, one smart contract can interact with others in unlimited combinations. So that developers can stack smart contracts on top of one another like Lego.")]),e._v(" "),c("p",[e._v("To achieve composability, smart contract programming languages must be designed to make it easier for contracts to talk to each other.")]),e._v(" "),c("p",[e._v("Solidity on EVM makes contracts inherently composable through synchronous external function calls and the ABI specification.")]),e._v(" "),c("p",[e._v("But for Solidity++ on Vite, things are not that simple. Because Vite is an asynchronous blockchain, calls to smart contracts on Vite are also "),c("strong",[e._v("asynchronous")]),e._v(", that is, the return value cannot be obtained immediately after the call.\nTherefore, the composability can only be achieved through the callback functions in the early version of Solidity++ (before 0.8.1).")]),e._v(" "),c("h2",{attrs:{id:"composability-using-callbacks"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#composability-using-callbacks"}},[e._v("#")]),e._v(" Composability Using Callbacks")]),e._v(" "),c("p",[e._v("Achieving composability through callbacks is rather painful for developers.")]),e._v(" "),c("p",[e._v("Let's start with a simple example:")]),e._v(" "),c("ul",[c("li",[e._v("Contract "),c("code",[e._v("A")]),e._v(" has an "),c("code",[e._v("add()")]),e._v(" method that returns the sum of two unsigned integers.")]),e._v(" "),c("li",[e._v("Contract "),c("code",[e._v("B")]),e._v(" has a "),c("code",[e._v("test()")]),e._v(" method that calculates the sum of "),c("code",[e._v("1")]),e._v(" and "),c("code",[e._v("2")]),e._v(" by calling "),c("code",[e._v("A.add()")]),e._v(", and stores the result in the storage variable "),c("code",[e._v("data")]),e._v(".")])]),e._v(" "),c("p",[e._v("Straightforward, the implementation in Solidity is as follows:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"javascript",base64:"Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguMDsKCmNvbnRyYWN0IEEgewogICAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBleHRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBhICsgYjsKICAgIH0KfQoKY29udHJhY3QgQiB7CiAgICBBIGNvbnRyYWN0QTsKICAgIHVpbnQgcHVibGljIGRhdGE7CgogICAgY29uc3RydWN0b3IgKGFkZHJlc3MgYWRkcikgewogICAgICAgIGNvbnRyYWN0QSA9IEEoYWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gdGVzdCgpIGV4dGVybmFsIHsKICAgICAgICBkYXRhID0gY29udHJhY3RBLmFkZCgxLCAyKTsKICAgIH0KfQo="}}),e._v(" "),c("p",[e._v("It can be implemented using callbacks in Solidity++ 0.8.0 as follows:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"javascript",base64:"Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5cHAgXjAuOC4wOwoKY29udHJhY3QgQSB7CiAgICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIsIGZ1bmN0aW9uKHVpbnQpIGV4dGVybmFsIGNhbGxiYWNrKSBleHRlcm5hbCB7CiAgICAgICAgaWYgKGNhbGxiYWNrLmFkZHJlc3MgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICAvLyBzZW5kIGNhbGxiYWNrIHRvIHJldHVybiBkYXRhIHRvIHRoZSBjYWxsZXIKICAgICAgICAgICAgY2FsbGJhY2soYSArIGIpOwogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgQiB7CiAgICBBIGNvbnRyYWN0QTsKICAgIHVpbnQgcHVibGljIGRhdGE7CgogICAgY29uc3RydWN0b3IgKGFkZHJlc3MgYWRkcikgewogICAgICAgIGNvbnRyYWN0QSA9IEEoYWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gdGVzdCgpIGV4dGVybmFsIHsKICAgICAgICBjb250cmFjdEEuYWRkKDEsIDIsIHRoaXMuY2FsbGJhY2tfb25BZGQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxiYWNrX29uQWRkKHVpbnQgcmVzdWx0KSBleHRlcm5hbCB7CiAgICAgICAgLy8gcmVjZWl2ZSBkYXRhIGZyb20gdGhlIGNhbGxlZCBjb250cmFjdAogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKGNvbnRyYWN0QSkpOwogICAgICAgIGRhdGEgPSByZXN1bHQ7CiAgICB9Cn0K"}}),e._v(" "),c("p",[e._v("We add an additional parameter "),c("code",[e._v("callback")]),e._v(" of type "),c("code",[e._v("function(uint) external")]),e._v(" to "),c("code",[e._v("A.add()")]),e._v(".")]),e._v(" "),c("p",[e._v("When contract "),c("code",[e._v("B")]),e._v(" calls contract "),c("code",[e._v("A")]),e._v(", it needs to pass the callback function "),c("code",[e._v("this.callback_onAdd")]),e._v(" as an argument of "),c("code",[e._v("A.add()")]),e._v(".")]),e._v(" "),c("p",[e._v("Contract "),c("code",[e._v("A")]),e._v(" can obtain the address of the caller and the selector of the callback function through the "),c("code",[e._v("callback")]),e._v(" parameter. It puts the result of "),c("code",[e._v("a + b")]),e._v(" in the first argument and initiates a call to the "),c("code",[e._v("callback")]),e._v(" function to return data to "),c("code",[e._v("B")]),e._v(".")]),e._v(" "),c("p",[e._v("In the callback function "),c("code",[e._v("callback_onAdd()")]),e._v(" of contract "),c("code",[e._v("B")]),e._v(", it gets the result of "),c("code",[e._v("A.add()")]),e._v(" from the parameter "),c("code",[e._v("result")]),e._v(" and assigns it to the storage variable "),c("code",[e._v("data")]),e._v(".")]),e._v(" "),c("p",[e._v("It works fine and the code doesn't look too complicated, no pain at all, right?")]),e._v(" "),c("p",[e._v("Once the call stack gets deeper, you won't think so anymore.")]),e._v(" "),c("h2",{attrs:{id:"callback-hell"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#callback-hell"}},[e._v("#")]),e._v(" Callback Hell")]),e._v(" "),c("p",[e._v("Let's expand this example a bit to see what happens.")]),e._v(" "),c("p",[e._v("In a more complex example:")]),e._v(" "),c("ul",[c("li",[e._v("We add a "),c("code",[e._v("sum()")]),e._v(" method to contract "),c("code",[e._v("B")]),e._v(", that calculates the sum of 3 integers by calling the "),c("code",[e._v("add()")]),e._v(" method of contract "),c("code",[e._v("A")]),e._v(" twice, and returns the final result to the caller by initiating a callback.")]),e._v(" "),c("li",[e._v("Add another contract "),c("code",[e._v("C")]),e._v(" to call contract "),c("code",[e._v("B")]),e._v(" to calculate the sum of the integers "),c("code",[e._v("1")]),e._v(", "),c("code",[e._v("2")]),e._v(", and "),c("code",[e._v("3")]),e._v(".")])]),e._v(" "),c("p",[e._v("In Solidity, implementing such an extension is straightforward.")]),e._v(" "),c("p",[e._v("We can initiate two calls to "),c("code",[e._v("A.add()")]),e._v(" in sequence in the "),c("code",[e._v("B.sum()")]),e._v(" function, and pass the partial result returned from the first call as the argument of the second call.")]),e._v(" "),c("p",[e._v("Here is the implementation in Solidity:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"javascript",base64:"Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguMDsKCmNvbnRyYWN0IEEgewogICAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBleHRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBhICsgYjsKICAgIH0KfQoKY29udHJhY3QgQiB7CiAgICBBIGNvbnRyYWN0QTsKICAgIGNvbnN0cnVjdG9yIChhZGRyZXNzIGFkZHIpIHsKICAgICAgICBjb250cmFjdEEgPSBBKGFkZHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN1bSh1aW50IGEsIHVpbnQgYiwgdWludCBjKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHVpbnQgcGFydGlhbFJlc3VsdCA9IGNvbnRyYWN0QS5hZGQoYSwgYik7CiAgICAgICAgcmV0dXJuIGNvbnRyYWN0QS5hZGQocGFydGlhbFJlc3VsdCwgYyk7CiAgICB9Cn0KCgpjb250cmFjdCBDIHsKICAgIEIgY29udHJhY3RCOwogICAgdWludCBwdWJsaWMgZGF0YTsKICAgIAogICAgY29uc3RydWN0b3IgKGFkZHJlc3MgYWRkcikgewogICAgICAgIGNvbnRyYWN0QiA9IEIoYWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gdGVzdCgpIGV4dGVybmFsIHsKICAgICAgICBkYXRhID0gY29udHJhY3RCLnN1bSgxLCAyLCAzKTsKICAgIH0KfQo="}}),e._v(" "),c("p",[e._v("We can see that the contract "),c("code",[e._v("A")]),e._v(" doesn't change anything compared to the previous example.")]),e._v(" "),c("p",[e._v("So can contract "),c("code",[e._v("A")]),e._v(" also remain unchanged with the implementation using callbacks in Solidity++?")]),e._v(" "),c("p",[e._v("Unfortunately, the answer is NO. We have to extend the called contracts to keep them composable in Solidity++ 0.8.0, the code is as follows：")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"javascript",base64:"Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5cHAgXjAuOC4wOwoKY29udHJhY3QgQSB7CiAgICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIsIGZ1bmN0aW9uKHVpbnQsIGZ1bmN0aW9uKHVpbnQpIGV4dGVybmFsLCB1aW50KSBleHRlcm5hbCBjYWxsYmFjaywgZnVuY3Rpb24odWludCkgZXh0ZXJuYWwgb3JpZ2luLCB1aW50IGNvbnRleHQpIGV4dGVybmFsIHsKICAgICAgICBpZiAoY2FsbGJhY2suYWRkcmVzcyAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIC8vIHNlbmQgY2FsbGJhY2sgdG8gcmV0dXJuIGRhdGEgdG8gdGhlIGNhbGxlcgogICAgICAgICAgICBjYWxsYmFjayhhICsgYiwgb3JpZ2luLCBjb250ZXh0KTsKICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IEIgewogICAgQSBjb250cmFjdEE7CgogICAgY29uc3RydWN0b3IgKGFkZHJlc3MgYWRkcikgewogICAgICAgIGNvbnRyYWN0QSA9IEEoYWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gc3VtKHVpbnQgYSwgdWludCBiLCB1aW50IGMsIGZ1bmN0aW9uKHVpbnQpIGV4dGVybmFsIG9yaWdpbikgZXh0ZXJuYWwgewogICAgICAgIC8vIGluaXRpYXRlIHRoZSBmaXJzdCBjYWxsIHRvIEEuYWRkKCkKICAgICAgICBjb250cmFjdEEuYWRkKGEsIGIsIHRoaXMuY2FsbGJhY2tfb25BZGQxLCBvcmlnaW4sIGMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxiYWNrX29uQWRkMSh1aW50IHBhcnRpYWxSZXN1bHQsIGZ1bmN0aW9uKHVpbnQpIGV4dGVybmFsIG9yaWdpbiwgdWludCBjb250ZXh0KSBleHRlcm5hbCB7CiAgICAgICAgLy8gcmVjZWl2ZSBkYXRhIGZyb20gdGhlIGZpcnN0IGNhbGwKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhjb250cmFjdEEpKTsKICAgICAgICAvLyBpbml0aWF0ZSB0aGUgc2Vjb25kIGNhbGwgdG8gQS5hZGQoKSAKICAgICAgICBjb250cmFjdEEuYWRkKHBhcnRpYWxSZXN1bHQsIGNvbnRleHQsIHRoaXMuY2FsbGJhY2tfb25BZGQyLCBvcmlnaW4sIDApOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxiYWNrX29uQWRkMih1aW50IHJlc3VsdCwgZnVuY3Rpb24odWludCkgZXh0ZXJuYWwgb3JpZ2luLCB1aW50KSBleHRlcm5hbCB7CiAgICAgICAgLy8gcmVjZWl2ZSBkYXRhIGZyb20gdGhlIHNlY29uZCBjYWxsCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MoY29udHJhY3RBKSk7CiAgICAgICAgaWYgKG9yaWdpbi5hZGRyZXNzICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgLy8gc2VuZCBjYWxsYmFjayB0byByZXR1cm4gZmluYWwgcmVzdWx0IHRvIHRoZSBjYWxsZXIKICAgICAgICAgICAgLy8gdGhlIHRhcmdldCBpcyBjb250cmFjdCBDIHJhdGhlciB0aGFuIGNvbnRyYWN0IEEKICAgICAgICAgICAgb3JpZ2luKHJlc3VsdCk7CiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBDIHsKICAgIEIgY29udHJhY3RCOwogICAgdWludCBwdWJsaWMgZGF0YTsKICAgIAogICAgY29uc3RydWN0b3IgKGFkZHJlc3MgYWRkcikgewogICAgICAgIGNvbnRyYWN0QiA9IEIoYWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gdGVzdCgpIGV4dGVybmFsIHsKICAgICAgICBjb250cmFjdEIuc3VtKDEsIDIsIDMsIHRoaXMuY2FsbGJhY2tfb25TdW0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxiYWNrX29uU3VtKHVpbnQgcmVzdWx0KSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MoY29udHJhY3RCKSk7CiAgICAgICAgZGF0YSA9IHJlc3VsdDsKICAgIH0KfQo="}}),e._v(" "),c("p",[e._v("Let's see what additional work is required to keep the contracts composable in Solidity++ with only callbacks:")]),e._v(" "),c("ul",[c("li",[c("p",[e._v("We need to add two callback functions to contract "),c("code",[e._v("B")]),e._v(". In the first callback function "),c("code",[e._v("B.callback_onAdd1()")]),e._v(", we receive the partial result of the first call to "),c("code",[e._v("A.add(a, b)")]),e._v(", and use this as an argument to initiate the second call to "),c("code",[e._v("A.add()")]),e._v(". In the second callback function "),c("code",[e._v("B.callback_onAdd2()")]),e._v(", we receive the final result of the second call to "),c("code",[e._v("A.add(a, b)")]),e._v(", and use this to initiate the callback to contract "),c("code",[e._v("C")]),e._v(".")])]),e._v(" "),c("li",[c("p",[e._v("In order to initiate a callback request to the original caller "),c("code",[e._v("C")]),e._v(" to return the final result, "),c("code",[e._v("B")]),e._v(" must record the address of the origin. "),c("code",[e._v("B")]),e._v(" can obtain the address of "),c("code",[e._v("C")]),e._v(" in the function "),c("code",[e._v("B.sum()")]),e._v(", but cannot pass it to the callback function "),c("code",[e._v("B.callback_onAdd2()")]),e._v(", because the VM context cannot be shared between different functions due to the asynchronous nature of Vite. Therefore, we have to put the address and callback method id in an "),c("code",[e._v("origin")]),e._v(" parameter of the "),c("code",[e._v("A.add()")]),e._v(" function.")])]),e._v(" "),c("li",[c("p",[e._v("Similarly, in order to use the third parameter "),c("code",[e._v("c")]),e._v(" of the "),c("code",[e._v("B.sum()")]),e._v(" function as the second argument of the second call to "),c("code",[e._v("A.add()")]),e._v(", we need to extend the parameter list of "),c("code",[e._v("A.add()")]),e._v(" and "),c("code",[e._v("B.callback_onAdd1()")]),e._v(" by adding a "),c("code",[e._v("context")]),e._v(" parameter.")])])]),e._v(" "),c("p",[e._v("As we can see, even for such a simple scenario, the contract code has become cluttered.")]),e._v(" "),c("p",[e._v("It comes from the famous problem of "),c("em",[e._v("Callback Hell")]),e._v(": Using low-level callbacks makes code difficult to write and understand. It also increases the difficulty of identifying the control flow for a contract.")]),e._v(" "),c("h2",{attrs:{id:"composability-using-await-operator"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#composability-using-await-operator"}},[e._v("#")]),e._v(" Composability Using Await Operator")]),e._v(" "),c("p",[e._v("In order to make contracts written in Solidity++ as simple and straightforward as those written in Solidity, we need to introduce an "),c("code",[e._v("await")]),e._v(" operator as in some modern programming languages such as javascript and C#.")]),e._v(" "),c("p",[e._v("Await operator suspends evaluation of the enclosing async function until the asynchronous operation represented by its operand completes. When the asynchronous operation completes, it returns the result of the operation, if any.")]),e._v(" "),c("p",[e._v("It helps you write synchronous-looking Solidity++ code that works asynchronously.")]),e._v(" "),c("p",[e._v("When the example is implemented in Solidity++ with "),c("code",[e._v("await")]),e._v(" operator, the code will be as straightforward and concise as in Solidity:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"javascript",base64:"Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5cHAgXjAuOC4xOwoKY29udHJhY3QgQSB7CiAgICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGV4dGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGEgKyBiOwogICAgfQp9Cgpjb250cmFjdCBCIHsKICAgIEEgY29udHJhY3RBOwogICAgY29uc3RydWN0b3IgKGFkZHJlc3MgYWRkcikgewogICAgICAgIGNvbnRyYWN0QSA9IEEoYWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gc3VtKHVpbnQgYSwgdWludCBiLCB1aW50IGMpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBwYXJ0aWFsUmVzdWx0ID0gYXdhaXQgY29udHJhY3RBLmFkZChhLCBiKTsKICAgICAgICByZXR1cm4gYXdhaXQgY29udHJhY3RBLmFkZChwYXJ0aWFsUmVzdWx0LCBjKTsKICAgIH0KfQoKCmNvbnRyYWN0IEMgewogICAgQiBjb250cmFjdEI7CiAgICB1aW50IHB1YmxpYyBkYXRhOwogICAgCiAgICBjb25zdHJ1Y3RvciAoYWRkcmVzcyBhZGRyKSB7CiAgICAgICAgY29udHJhY3RCID0gQihhZGRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0ZXN0KCkgZXh0ZXJuYWwgewogICAgICAgIGRhdGEgPSBhd2FpdCBjb250cmFjdEIuc3VtKDEsIDIsIDMpOwogICAgfQp9Cgo="}}),e._v(" "),c("h1",{attrs:{id:"implementation"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#implementation"}},[e._v("#")]),e._v(" Implementation")]),e._v(" "),c("h2",{attrs:{id:"objectives"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#objectives"}},[e._v("#")]),e._v(" Objectives")]),e._v(" "),c("p",[e._v("To make this happen, the Solidity++ compiler and Vite VM have to do most mechanical works for developers under the hood.")]),e._v(" "),c("p",[e._v("Let's dissect the code to see what specific work needs to be done by the compiler and VM:")]),e._v(" "),c("p",[c("img",{attrs:{src:a(626),alt:"dissect the code"}})]),e._v(" "),c("p",[e._v("In summary, there are the following tasks for the compiler and VM:")]),e._v(" "),c("ul",[c("li",[e._v("To generate callback entries for each synchronous call automatically at compile time.")]),e._v(" "),c("li",[e._v("To initiate a callback request when the result is returned.")]),e._v(" "),c("li",[e._v("To maintain execution context during function invocations and callbacks.")])]),e._v(" "),c("h2",{attrs:{id:"solidity-compiler-and-evm"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#solidity-compiler-and-evm"}},[e._v("#")]),e._v(" Solidity Compiler and EVM")]),e._v(" "),c("p",[e._v("Before deciding how to implement it, let's take a look at the output from Solidity compiler for this example.")]),e._v(" "),c("p",[e._v("Pseudo assembly code for contract "),c("code",[e._v("A")]),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ZnVuY3Rpb25fc2VsZWN0b3I6Cm1ldGhvZF9pZCA6PSBjYWxsZGF0YSgwLCA0KQppZiBtZXRob2RfaWQgPT0gc2lnX2hhc2goYWRkKQogICAganVtcCh0YWdfZnVuY3Rpb25fYWRkKQplbHNlCiAgICBmYWxsYmFjaygpCnN0b3AKCnRhZ19mdW5jdGlvbl9hZGQ6CmEsIGIgOj0gYWJpX2RlY29kZShjYWxsZGF0YSkKdG1wIDo9IGNoZWNrZWRfYWRkKGEsIGIpCnJldCA6PSBhYmlfZW5jb2RlKHRtcCkKcmV0dXJuKHJldCkK"}}),e._v(" "),c("p",[e._v("Pseudo assembly code for contract "),c("code",[e._v("B")]),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ZnVuY3Rpb25fc2VsZWN0b3I6Cm1ldGhvZF9pZCA6PSBjYWxsZGF0YSgwLCA0KQppZiBtZXRob2RfaWQgPT0gc2lnX2hhc2godGVzdCkKICAgIGp1bXAodGFnX2Z1bmN0aW9uX3Rlc3QpCmVsc2UKICAgIGZhbGxiYWNrKCkKc3RvcAoKdGFnX2Z1bmN0aW9uX3Rlc3Q6CmNvbnRyYWN0X2FkZHJlc3MgOj0gY29udHJhY3RBCm1ldGhvZF9pZCA6PSBzaWdfaGFzaChhZGQpCnBhcmFtcyA6PSBhYmlfZW5jb2RlKDEsIDIpCmNhbGwoY29udHJhY3RfYWRkcmVzcywgbWV0aG9kX2lkLCBwYXJhbXMpCnJldCA6PSBhYmlfZGVjb2RlKHJldHVybmRhdGEpCmRhdGEgPSByZXQKcmV0dXJuCg=="}}),e._v(" "),c("p",[e._v("To make the control flow clear, let's put these in an anatomy diagram:")]),e._v(" "),c("p",[c("img",{attrs:{src:a(627),alt:"compiled from solidity"}})]),e._v(" "),c("p",[e._v("As shown by the red arrows in the diagram, the EVM executes external function calls through the "),c("code",[e._v("call")]),e._v(" and "),c("code",[e._v("return")]),e._v(" instructions.")]),e._v(" "),c("p",[e._v("The Solidity compiler will create a piece of code called "),c("em",[e._v("function selector")]),e._v(" for each contract that includes the entries to interface functions of the contract at compile time.")]),e._v(" "),c("p",[e._v("When executing a message call to a contract, EVM extracts the first four bytes from "),c("em",[e._v("calldata")]),e._v(" and compare against the method id of each function. If there’s a match, then jump to the definition of a corresponding function and keep executing. If there’s no match, then jump to the fallback function either defined by user or automatically created by the compiler.")]),e._v(" "),c("p",[e._v("When the "),c("code",[e._v("call")]),e._v(" instruction gets executed, the EVM will retrieve the callee's address and load the callee’s code from the address and execute the code in an independent context.")]),e._v(" "),c("p",[e._v("When the "),c("code",[e._v("return")]),e._v(" instruction gets executed, the EVM will place the result of the execution into the memory and exits from the callee's code, and then keep executing the remaining code of the caller.")]),e._v(" "),c("h2",{attrs:{id:"solidity-compiler"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#solidity-compiler"}},[e._v("#")]),e._v(" Solidity++ Compiler")]),e._v(" "),c("p",[e._v("Let's start extending the functionality on the Solidity compiler, introducing the new features mentioned above:")]),e._v(" "),c("ul",[c("li",[e._v("To generate a callback entry, the compiler needs to traverse all "),c("code",[e._v("await")]),e._v(" expressions in the contract at compile time, add a tag to each position immediately after the "),c("code",[e._v("await")]),e._v(", and add it to the function selector as a callback entry.")]),e._v(" "),c("li",[e._v("To initiate a callback request when the result is returned, we need to reimplement the "),c("code",[e._v("return")]),e._v(" instruction in the Vite VM to initiate a send transaction with type of "),c("code",[e._v("SendCallback")]),e._v(".")]),e._v(" "),c("li",[e._v("To maintain execution context, two new instructions "),c("code",[e._v("synccall")]),e._v(" and "),c("code",[e._v("callbackdest")]),e._v(" need to be introduced into the Vite VM.")])]),e._v(" "),c("p",[e._v("The compiler places a "),c("code",[e._v("synccall")]),e._v(" instruction at each synchronous call. When the VM executes the "),c("code",[e._v("synccall")]),e._v(" instruction, it initiates a send transaction with type of "),c("code",[e._v("SendSyncCall")]),e._v(" and persists the execution context into the local database.")]),e._v(" "),c("p",[e._v("Similarly, the compiler places a "),c("code",[e._v("callbackdest")]),e._v(" instruction at each callback. When the VM executes the "),c("code",[e._v("callbackdest")]),e._v(" instruction, it restores the execution context from the local database and then resumes execution.")]),e._v(" "),c("p",[e._v("This design allows the compiler to generate code that can run on an asynchronous VM for contracts written in a programming language similar to Solidity.")]),e._v(" "),c("p",[e._v("The example will be compiled to the following code:")]),e._v(" "),c("p",[e._v("Pseudo assembly code for contract "),c("code",[e._v("A")]),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ZnVuY3Rpb25fc2VsZWN0b3I6Cm1ldGhvZF9pZCA6PSBjYWxsZGF0YSgwLCA0KQppZiBtZXRob2RfaWQgPT0gc2lnX2hhc2goYWRkKQogICAganVtcCh0YWdfZnVuY3Rpb25fYWRkKQplbHNlCiAgICBmYWxsYmFjaygpCnN0b3AKCnRhZ19mdW5jdGlvbl9hZGQ6CmEsIGIgOj0gYWJpX2RlY29kZShjYWxsZGF0YSkKdG1wIDo9IGNoZWNrZWRfYWRkKGEsIGIpCnJldCA6PSBhYmlfZW5jb2RlKHRtcCkKcmV0dXJuKHJldCkK"}}),e._v(" "),c("p",[e._v("Pseudo assembly code for contract "),c("code",[e._v("B")]),e._v(":\n"),c("pre",[c("code",[e._v("function_selector:\nmethod_id := calldata(0, 4)\nif method_id == sig_hash(test)\njump(tag_function_test)\n"),c("strong",[e._v("else if method_id == 0x00000001\njump(tag_callback_01)")]),e._v("\nelse\nfallback()\nstop\n"),c("br"),e._v("tag_function_test:\ncontract_address := contractA\nmethod_id := sig_hash(add)\nparams := abi_encode(1, 2)\n"),c("strong",[e._v("callback_id := 0x00000001\nsynccall(contract_address, method_id, params, callback_id)")]),e._v("\nstop\n"),c("br"),c("strong",[e._v("tag_callback_01:\ncallbackdest\nret := abi_decode(calldata)\nreturn(ret)")])])])]),e._v(" "),c("p",[e._v("Again, let's put these in an anatomy diagram:")]),e._v(" "),c("p",[c("img",{attrs:{src:a(628),alt:"compiled from soliditypp"}})]),e._v(" "),c("p",[e._v("The blue part of the assembly code is generated by the Solidity++ compiler specifically for the Vite VM.")]),e._v(" "),c("p",[e._v("The orange and green circles represent the "),c("em",[e._v("send")]),e._v(" ("),c("em",[e._v("request")]),e._v(") transaction and "),c("em",[e._v("receive")]),e._v(" ("),c("em",[e._v("response")]),e._v(") transaction initiated by the Vite VM, respectively.")]),e._v(" "),c("p",[e._v("As we can see, the compiler translates each "),c("code",[e._v("await")]),e._v(" expression into a set of instructions in the same pattern: inserting a "),c("code",[e._v("synccall")]),e._v(" instruction, a "),c("code",[e._v("stop")]),e._v(" instruction, a jump dest tag (a "),c("code",[e._v("jumpdest")]),e._v(" instruction), and a "),c("code",[e._v("callbackdest")]),e._v(" instruction.")]),e._v(" "),c("p",[e._v("Essentially, the Vite VM treats the "),c("code",[e._v("synccall")]),e._v(" instruction as an "),c("em",[e._v("interrupt")]),e._v(", which is a request for the VM to interrupt currently executing code, save its context, and initiate an asynchronous request transaction.")]),e._v(" "),c("p",[e._v("Correspondingly, before receiving a callback and resuming execution, the execution context needs to be restored by executing the "),c("code",[e._v("callbackdest")]),e._v(" instruction.")]),e._v(" "),c("p",[e._v("This pattern is known as "),c("em",[e._v("context switch")]),e._v(". In a multi-task system, it refers to the process of storing the system state for a task, so that task can be paused and resumed later.")]),e._v(" "),c("h2",{attrs:{id:"vite-vm"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#vite-vm"}},[e._v("#")]),e._v(" Vite VM")]),e._v(" "),c("p",[e._v("Vite VM retains the semantics of most EVM instructions, but is not a clone of EVM. Therefore, new instructions such as "),c("code",[e._v("synccall")]),e._v(" and "),c("code",[e._v("callbackdest")]),e._v(" need to be implemented from scratch, and some EVM instructions such as "),c("code",[e._v("return")]),e._v(", "),c("code",[e._v("returndatasize")]),e._v(", "),c("code",[e._v("returndatacopy")]),e._v(" need to be reimplemented to adapt to the Vite protocol.")]),e._v(" "),c("h3",{attrs:{id:"transaction-types"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#transaction-types"}},[e._v("#")]),e._v(" Transaction Types")]),e._v(" "),c("p",[e._v("Three new transaction types need to be introduced:")]),e._v(" "),c("ul",[c("li",[c("strong",[e._v("SendSyncCall")]),e._v(": A send transaction initiated by a synchronous call,")]),e._v(" "),c("li",[c("strong",[e._v("SendCallback")]),e._v(": A send transaction initiated by a callback that successfully executes and returns a result.")]),e._v(" "),c("li",[c("strong",[e._v("SendFailureCallback")]),e._v(": A send transaction initiated by a callback that fails to execute and returns an error.")])]),e._v(" "),c("h3",{attrs:{id:"execution-context"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#execution-context"}},[e._v("#")]),e._v(" Execution Context")]),e._v(" "),c("p",[e._v("Each transaction with one of the three new types contains an execution context data stored in the database.")]),e._v(" "),c("p",[e._v("The execution context is defined as follows:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"RXhlY3V0aW9uQ29udGV4dCB7CglyZWZlcnJlciB0eXBlcy5IYXNoCgljYWxsYmFjayBiaWcuSW50CglzdGFjayAgW11iaWcuSW50CgltZW1vcnkgW11ieXRlCn0K"}}),e._v(" "),c("p",[e._v("For a "),c("code",[e._v("SendSyncCall")]),e._v(" transaction, its execution context includes:")]),e._v(" "),c("ul",[c("li",[c("code",[e._v("referrer")]),e._v(" holds the send transaction hash of the upstream (origin) sync call.")]),e._v(" "),c("li",[c("code",[e._v("callback")]),e._v(" holds the 4-bytes method id of the callback function entry.")]),e._v(" "),c("li",[c("code",[e._v("stack")]),e._v(" holds a snapshot of the contract stack at the time "),c("code",[e._v("synccall")]),e._v(" is executed.")]),e._v(" "),c("li",[c("code",[e._v("memory")]),e._v(" holds a snapshot of the contract memory at the time "),c("code",[e._v("synccall")]),e._v(" is executed.")])]),e._v(" "),c("p",[e._v("For a "),c("code",[e._v("SendCallback")]),e._v(" or a "),c("code",[e._v("SendFailureCallback")]),e._v(" transaction, its execution context only includes a "),c("code",[e._v("referrer")]),e._v(" field:")]),e._v(" "),c("ul",[c("li",[c("code",[e._v("referrer")]),e._v(" holds the send transaction hash of the latest sync call.")])]),e._v(" "),c("p",[e._v("If "),c("code",[e._v("referrer")]),e._v(" confuses you, see the example below：")]),e._v(" "),c("div",{attrs:{align:"center"}},[c("img",{staticStyle:{width:"auto"},attrs:{src:a(629),alt:"referrer"}})]),e._v(" "),c("h3",{attrs:{id:"synccall-instruction"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#synccall-instruction"}},[e._v("#")]),e._v(" SyncCall Instruction")]),e._v(" "),c("p",[e._v("The "),c("code",[e._v("synccall")]),e._v(" instruction is implemented in pseudocode as follows:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBvcFN5bmNjYWxsKCkgewogICAgY2FsbGJhY2ssIHRvQWRkcmVzcywgdG9rZW5JRCwgYW1vdW50LCBpbk9mZnNldCwgaW5TaXplIDo9IHZtLnN0YWNrLnBvcCg2KQoJY2FsbGRhdGEgOj0gdm0ubWVtLmdldChpbk9mZnNldCwgaW5TaXplKQoKCWlmIHZtLkNvbnRleHQub3JpZ2luU2VuZEJsb2NrID09IG5pbCB7CiAgICAgICAgLy8gdXBzdHJlYW0gY2FsbAoJCW9yaWdpbiA6PSB0aGlzLnNlbmRCbG9jawoJfSBlbHNlIHsKICAgICAgICAvLyBsb2FkIG9yaWdpbiBmcm9tIFZNIGNvbnRleHQsIGl0IHdhcyBzYXZlZCBieSBwcmV2aW91cyBjYWxsYmFja2Rlc3QKCQlvcmlnaW4gOj0gdm0uQ29udGV4dC5PcmlnaW4KCX0KCgl0eCA6PSBWaXRlUmVxdWVzdFRyYW5zYWN0aW9uIHsKCQlmcm9tOiB0aGlzLmFkZHJlc3MsCgkJdG86IHRvQWRkcmVzcywKCQl0eXBlOiBTZW5kU3luY0NhbGwsCgkJdmFsdWU6IGFtb3VudCwKCQl0b2tlbjogdG9rZW5JRCwKCQlkYXRhOiBjYWxsZGF0YQogICAgICAgIGV4ZWN1dGlvbkNvbnRleHQ6IEV4ZWN1dGlvbkNvbnRleHQgewogICAgICAgICAgICByZWZlcnJlcjogb3JpZ2luLkhhc2gsCiAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFjaywKICAgICAgICAgICAgc3RhY2s6IHZtLnN0YWNrLAogICAgICAgICAgICBtZW1vcnk6IHZtLm1lbW9yeSwKCSAgICB9CiAgICB9CgoJdml0ZS50cmlnZ2VyKHR4KQp9Cg=="}}),e._v(" "),c("h3",{attrs:{id:"return-instruction"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#return-instruction"}},[e._v("#")]),e._v(" Return Instruction")]),e._v(" "),c("p",[e._v("The "),c("code",[e._v("return")]),e._v(" instruction is implemented in pseudocode as follows:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBvcFJldHVybigpIHsKICAgIG9mZnNldCwgc2l6ZSA6PSB2bS5zdGFjay5wb3AoMikKCXJldCA6PSB2bS5tZW0uZ2V0KG9mZnNldCwgc2l6ZSkKCglzZW5kVHlwZSA6PSB0aGlzLnNlbmRCbG9jay5CbG9ja1R5cGUKCS8vIG5lZWQgdG8gdHJpZ2dlciBhIGNhbGxiYWNrIHRyYW5zYWN0aW9uCglpZiBzZW5kVHlwZSA9PSBTZW5kU3luY0NhbGwgfHwgc2VuZFR5cGUgPT0gU2VuZENhbGxiYWNrIHx8IHNlbmRUeXBlID09IFNlbmRGYWlsdXJlQ2FsbGJhY2sgewoJCS8vIGdldCB0aGUgc2VuZC1ibG9jayBvZiB0aGUgb3JpZ2luYWwgY2FsbAoJCWlmIHZtLkNvbnRleHQuT3JpZ2luID09IG5pbCB7CiAgICAgICAgICAgIC8vIHRoZSByZXR1cm4gc3RhdGVtZW50IGlzIG5vdCBpbiBhIGNhbGxiYWNrIGZ1bmN0aW9uCiAgICAgICAgICAgIC8vIHNvIG9yaWdpbiBpcyB0aGUgbGF0ZXN0IHNlbmQgdHJhbnNhY3Rpb24KCQkgICAgb3JpZ2luIDo9IHRoaXMuc2VuZEJsb2NrCgkJfSBlbHNlIHsKICAgICAgICAgICAgLy8gdGhlIHJldHVybiBzdGF0ZW1lbnQgaXMgaW4gYSBjYWxsYmFjayBmdW5jdGlvbgogICAgICAgICAgICAvLyBsb2FkIG9yaWdpbiBmcm9tIFZNIGNvbnRleHQsIGl0IHdhcyBzYXZlZCBieSBwcmV2aW91cyBjYWxsYmFja2Rlc3QKCQkJb3JpZ2luIDo9IHZtLkNvbnRleHQuT3JpZ2luCgkJfQoKCQlpZiBvcmlnaW4uQmxvY2tUeXBlID09IFNlbmRTeW5jQ2FsbCB7CgkJCWNhbGxiYWNrIDo9IG9yaWdpbi5leGVjdXRpb25Db250ZXh0LmNhbGxiYWNrCgkJCS8vIGNhbGxkYXRhIG9mIHRoZSBjYWxsYmFjazogW2NhbGxiYWNrX2lkXVtyZXR1cm5fZGF0YV0KCQkJZGF0YSA6PSBjb25jYXQoY2FsbGJhY2ssIHJldCkKCgkJCXR4IDo9IFZpdGVSZXF1ZXN0VHJhbnNhY3Rpb24gewoJCQkJZnJvbTogdGhpcy5hZGRyZXNzLAoJCQkJdG86IG9yaWdpbi5hZGRyZXNzLAoJCQkJdHlwZTogU2VuZENhbGxiYWNrLAoJCQkJZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgIGV4ZWN1dGlvbkNvbnRleHQ6IEV4ZWN1dGlvbkNvbnRleHR7CgkJCQkgICAgcmVmZXJyZXI6IG9yaWdpbi5IYXNoLAoJCQkgICAgfQogICAgICAgICAgICB9CgoJCQl2aXRlLnRyaWdnZXIodHgpCiAgICAgICAgfQogICAgfQo="}}),e._v(" "),c("h3",{attrs:{id:"callbackdest-instruction"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#callbackdest-instruction"}},[e._v("#")]),e._v(" CallbackDest Instruction")]),e._v(" "),c("p",[e._v("The "),c("code",[e._v("callbackdest")]),e._v(" instruction is implemented in pseudocode as follows:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBvcENhbGxiYWNrRGVzdCgpIHsKCXNlbmRUeXBlIDo9IHRoaXMuc2VuZEJsb2NrLkJsb2NrVHlwZQoJaWYgc2VuZFR5cGUgPT0gU2VuZENhbGxiYWNrIHx8IHNlbmRUeXBlID09IFNlbmRGYWlsdXJlQ2FsbGJhY2sgewoJCXJlZmVycmVyIDo9IHRoaXMuc2VuZEJsb2NrLmV4ZWN1dGlvbkNvbnRleHQucmVmZXJyZXIKCgkJLy8gdmFsaWRhdGUgc3luYyBjYWxsIHNlbmQgYmxvY2sKCQlpZiByZWZlcnJlci5hZGRyZXNzICE9IHRoaXMuYWRkcmVzcyB8fCByZWZlcnJlci5Ub0FkZHJlc3MgIT0gdGhpcy5zZW5kQmxvY2suYWRkcmVzcyB7CgkJCXJldHVybiBuaWwsIGVycm9yCgkJfQoKCQkvLyBnZXQgdXBzdHJlYW0gb3JpZ2luIHNlbmQgYmxvY2sKCQlvcmlnaW4gOj0gcmVmZXJyZXIuZXhlY3V0aW9uQ29udGV4dC5yZWZlcnJlcgoKCQkvLyB2YWxpZGF0ZSBvcmlnaW4gc2VuZCBibG9jawoJCWlmIG9yaWdpbi5Ub0FkZHJlc3MgIT0gdGhpcy5hZGRyZXNzIHsKCQkJcmV0dXJuIG5pbCwgZXJyb3IKCQl9CgoJCS8vIHNhdmUgb3JpZ2luIHNlbmQgYmxvY2sgdG8gVk0gY29udGV4dAoJCXZtLkNvbnRleHQuT3JpZ2luID0gb3JpZ2luCgoJCS8vIHJlc3RvcmUgc3RhY2sKCQl2bS5zdGFjayA9IHJlZmVycmVyLmV4ZWN1dGlvbkNvbnRleHQuc3RhY2sKCgkJLy8gcHVzaCBzdWNjZXNzIGZsYWcgKGFjdCBhcyBSRVRVUk4gaW5zdHJ1Y3Rpb24gaW4gRVZNKQoJCWlmIHNlbmRUeXBlID09IFNlbmRDYWxsYmFjayB7CgkJCS8vIHB1c2ggdHJ1ZQoJCQlzdGFjay5wdXNoKDEpCgkJfSBlbHNlIHsgLy8gc2VuZFR5cGUgPT0gU2VuZEZhaWx1cmVDYWxsYmFjawoJCQkvLyBwdXNoIGZhbHNlCgkJCXN0YWNrLnB1c2goMCkKCQl9CgoJCS8vIHJlc3RvcmUgbWVtb3J5CgkJdm0ubWVtb3J5ID0gcmVmZXJyZXIuZXhlY3V0aW9uQ29udGV4dC5tZW1vcnkKCX0KfQo="}}),e._v(" "),c("h2",{attrs:{id:"advanced-example"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#advanced-example"}},[e._v("#")]),e._v(" Advanced example")]),e._v(" "),c("details",[c("summary",[e._v("Show")]),e._v(" "),c("h3",{attrs:{id:"objectives-2"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#objectives-2"}},[e._v("#")]),e._v(" Objectives")]),e._v(" "),c("p",[c("img",{attrs:{src:a(630),alt:"dissect the code"}})]),e._v(" "),c("h3",{attrs:{id:"solidity-compiler-and-evm-2"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#solidity-compiler-and-evm-2"}},[e._v("#")]),e._v(" Solidity Compiler and EVM")]),e._v(" "),c("p",[e._v("Pseudo assembly code for contract "),c("code",[e._v("A")]),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ZnVuY3Rpb25fc2VsZWN0b3I6Cm1ldGhvZF9pZCA6PSBjYWxsZGF0YSgwLCA0KQppZiBtZXRob2RfaWQgPT0gc2lnX2hhc2goYWRkKQogICAganVtcCh0YWdfZnVuY3Rpb25fYWRkKQplbHNlCiAgICBmYWxsYmFjaygpCnN0b3AKCnRhZ19mdW5jdGlvbl9hZGQ6CmEsIGIgOj0gYWJpX2RlY29kZShjYWxsZGF0YSkKdG1wIDo9IGNoZWNrZWRfYWRkKGEsIGIpCnJldCA6PSBhYmlfZW5jb2RlKHRtcCkKcmV0dXJuKHJldCkK"}}),e._v(" "),c("p",[e._v("Pseudo assembly code for contract "),c("code",[e._v("B")]),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ZnVuY3Rpb25fc2VsZWN0b3I6Cm1ldGhvZF9pZCA6PSBjYWxsZGF0YSgwLCA0KQppZiBtZXRob2RfaWQgPT0gc2lnX2hhc2goc3VtKQogICAganVtcCh0YWdfZnVuY3Rpb25fc3VtKQplbHNlCiAgICBmYWxsYmFjaygpCnN0b3AKCnRhZ19mdW5jdGlvbl9zdW06CmEsIGIsIGMgOj0gYWJpX2RlY29kZShjYWxsZGF0YSkKY29udHJhY3RfYWRkcmVzcyA6PSBjb250cmFjdEEKbWV0aG9kX2lkIDo9IHNpZ19oYXNoKGFkZCkKcGFyYW1zIDo9IGFiaV9lbmNvZGUoYSwgYikKY2FsbChjb250cmFjdF9hZGRyZXNzLCBtZXRob2RfaWQsIHBhcmFtcykKcGFydGlhbFJlc3VsdCA6PSBhYmlfZGVjb2RlKHJldHVybmRhdGEpCnBhcmFtcyA6PSBhYmlfZW5jb2RlKHBhcnRpYWxSZXN1bHQsIGMpCmNhbGwoY29udHJhY3RfYWRkcmVzcywgbWV0aG9kX2lkLCBwYXJhbXMpCnJldCA6PSBhYmlfZGVjb2RlKHJldHVybmRhdGEpCnJldHVybihyZXQpCg=="}}),e._v(" "),c("p",[e._v("Pseudo assembly code for contract "),c("code",[e._v("C")]),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ZnVuY3Rpb25fc2VsZWN0b3I6Cm1ldGhvZF9pZCA6PSBjYWxsZGF0YSgwLCA0KQppZiBtZXRob2RfaWQgPT0gc2lnX2hhc2godGVzdCkKICAgIGp1bXAodGFnX2Z1bmN0aW9uX3Rlc3QpCmVsc2UKICAgIGZhbGxiYWNrKCkKc3RvcAoKdGFnX2Z1bmN0aW9uX3Rlc3Q6CmNvbnRyYWN0X2FkZHJlc3MgOj0gY29udHJhY3RCCm1ldGhvZF9pZCA6PSBzaWdfaGFzaChzdW0pCnBhcmFtcyA6PSBhYmlfZW5jb2RlKDEsIDIsIDMpCmNhbGwoY29udHJhY3RfYWRkcmVzcywgbWV0aG9kX2lkLCBwYXJhbXMpCnJldCA6PSBhYmlfZGVjb2RlKHJldHVybmRhdGEpCmRhdGEgPSByZXQKcmV0dXJuCg=="}}),e._v(" "),c("p",[c("img",{attrs:{src:a(631),alt:"compiled from solidity"}})]),e._v(" "),c("h3",{attrs:{id:"solidity-compiler-2"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#solidity-compiler-2"}},[e._v("#")]),e._v(" Solidity++ Compiler")]),e._v(" "),c("p",[e._v("Pseudo assembly code for contract "),c("code",[e._v("A")]),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ZnVuY3Rpb25fc2VsZWN0b3I6Cm1ldGhvZF9pZCA6PSBjYWxsZGF0YSgwLCA0KQppZiBtZXRob2RfaWQgPT0gc2lnX2hhc2goYWRkKQogICAganVtcCh0YWdfZnVuY3Rpb25fYWRkKQplbHNlCiAgICBmYWxsYmFjaygpCnN0b3AKCnRhZ19mdW5jdGlvbl9hZGQ6CmEsIGIgOj0gYWJpX2RlY29kZShjYWxsZGF0YSkKdG1wIDo9IGNoZWNrZWRfYWRkKGEsIGIpCnJldCA6PSBhYmlfZW5jb2RlKHRtcCkKcmV0dXJuKHJldCkK"}}),e._v(" "),c("p",[e._v("Pseudo assembly code for contract "),c("code",[e._v("B")]),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ZnVuY3Rpb25fc2VsZWN0b3I6Cm1ldGhvZF9pZCA6PSBjYWxsZGF0YSgwLCA0KQppZiBtZXRob2RfaWQgPT0gc2lnX2hhc2goc3VtKQogICAganVtcCh0YWdfZnVuY3Rpb25fc3VtKQplbHNlIGlmIG1ldGhvZF9pZCA9PSAweDAwMDAwMDAxCiAgICBqdW1wKHRhZ19jYWxsYmFja18wMSkKZWxzZSBpZiBtZXRob2RfaWQgPT0gMHgwMDAwMDAwMgogICAganVtcCh0YWdfY2FsbGJhY2tfMDIpCmVsc2UKICAgIGZhbGxiYWNrKCkKc3RvcAoKdGFnX2Z1bmN0aW9uX3N1bToKYSwgYiwgYyA6PSBhYmlfZGVjb2RlKGNhbGxkYXRhKQpjb250cmFjdF9hZGRyZXNzIDo9IGNvbnRyYWN0QQptZXRob2RfaWQgOj0gc2lnX2hhc2goYWRkKQpwYXJhbXMgOj0gYWJpX2VuY29kZShhLCBiKQpjYWxsYmFja19pZCA6PSAweDAwMDAwMDAxCnN5bmNjYWxsKGNvbnRyYWN0X2FkZHJlc3MsIG1ldGhvZF9pZCwgcGFyYW1zLCBjYWxsYmFja19pZCkKc3RvcAoKdGFnX2NhbGxiYWNrXzAxOgpjYWxsYmFja2Rlc3QKcCA6PSBhYmlfZGVjb2RlKGNhbGxkYXRhKQpjb250cmFjdF9hZGRyZXNzIDo9IGNvbnRyYWN0QQptZXRob2RfaWQgOj0gc2lnX2hhc2goYWRkKQpwYXJhbXMgOj0gYWJpX2VuY29kZShwLCBjKQpjYWxsYmFja19pZCA6PSAweDAwMDAwMDAyCnN5bmNjYWxsKGNvbnRyYWN0X2FkZHJlc3MsIG1ldGhvZF9pZCwgcGFyYW1zLCBjYWxsYmFja19pZCkKc3RvcAoKdGFnX2NhbGxiYWNrXzAyOgpjYWxsYmFja2Rlc3QKcmV0IDo9IGFiaV9kZWNvZGUoY2FsbGRhdGEpCnJldHVybihyZXQpCg=="}}),e._v(" "),c("p",[e._v("Pseudo assembly code for contract "),c("code",[e._v("C")]),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ZnVuY3Rpb25fc2VsZWN0b3I6Cm1ldGhvZF9pZCA6PSBjYWxsZGF0YSgwLCA0KQppZiBtZXRob2RfaWQgPT0gc2lnX2hhc2godGVzdCkKICAgIGp1bXAodGFnX2Z1bmN0aW9uX3Rlc3QpCmVsc2UgaWYgbWV0aG9kX2lkID09IDB4MDAwMDAwMDEKICAgIGp1bXAodGFnX2NhbGxiYWNrXzAxKQplbHNlCiAgICBmYWxsYmFjaygpCnN0b3AKCnRhZ19mdW5jdGlvbl90ZXN0Ogpjb250cmFjdF9hZGRyZXNzIDo9IGNvbnRyYWN0QgptZXRob2RfaWQgOj0gc2lnX2hhc2goc3VtKQpwYXJhbXMgOj0gYWJpX2VuY29kZSgxLCAyLCAzKQpjYWxsYmFja19pZCA6PSAweDAwMDAwMDAxCnN5bmNjYWxsKGNvbnRyYWN0X2FkZHJlc3MsIG1ldGhvZF9pZCwgcGFyYW1zLCBjYWxsYmFja19pZCkKc3RvcAoKdGFnX2NhbGxiYWNrXzAxOgpjYWxsYmFja2Rlc3QKcmV0IDo9IGFiaV9kZWNvZGUoY2FsbGRhdGEpCnJldHVybihyZXQpCg=="}}),e._v(" "),c("p",[c("img",{attrs:{src:a(632),alt:"compiled from soliditypp"}})]),e._v(" "),c("h3",{attrs:{id:"vite-vm-2"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#vite-vm-2"}},[e._v("#")]),e._v(" Vite VM")]),e._v(" "),c("p",[c("img",{attrs:{src:a(633),alt:"referrer"}})])],1)],1)}),[],!1,null,null,null);t.default=o.exports}}]);